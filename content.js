!function(){"use strict";let e={botEnabled:!1,botApiKey:"",botContext:"",botUseInvi:!1,botModel:"gemini-2.0-flash",botWelcomeEnabled:!1,botWelcomeMsg:""},t="",o=!1;const n=(()=>{const e=["󠁢","󠁣","󠁤","󠁥","󠁦","󠁧","󠁨","󠁩","󠁪","󠁫","󠁬","󠁭","󠁮","󠁯","󠁰","󠁱","󠁲","󠁳","󠁴","󠁵","󠁶","󠁷","󠁸","󠁹","󠁺","󠁿"],t=e.length,o=e.reduce(((e,t,o)=>(e[t]=o,e)),{}),n=new RegExp("‌([\\s\\S]+?)󠁡");return{encode:o=>{if(!o)return"";let n="";for(let r of o){let o=r.codePointAt(0),s=[];for(;o>0;)s.push(o%t),o=Math.floor(o/t);for(;s.length<5;)s.push(0);n+=s.reverse().map((t=>e[t])).join("")}return"‌"+n+"󠁡"},decode:e=>{const r=n.exec(e);if(!r)return e;const s=Array.from(r[1]);let l="";for(let e=0;e<s.length;e+=5){let n=s.slice(e,e+5);if(n.length<5)break;let r=n.map((e=>o[e])).reverse().reduce(((e,o,n)=>e+o*Math.pow(t,n)),0);l+=String.fromCodePoint(r)}return l},hasInvi:e=>n.test(e)}})();function r(o,r=null){if(r){const e=r.querySelectorAll(".actions .ant-col");if(e.length>0){const t=e[e.length-1].querySelector("button");t&&t.click()}}setTimeout((()=>{const r=document.querySelector(".input-send-box textarea")||document.querySelector("textarea"),s=document.querySelector("button.send-box")||document.querySelector("button[type='submit']");r&&s&&(r.value=e.botUseInvi?n.encode(o):`[AI]: ${o}`,r.dispatchEvent(new Event("input",{bubbles:!0})),t=o,setTimeout((()=>{s.disabled||s.click()}),350))}),400)}function s(){if(!e.botEnabled)return;const n=document.querySelectorAll(".sc-bMvGRv");if(0===n.length)return;const s=n[n.length-1];if(e.botWelcomeEnabled){const o=s.querySelector(".join");if(o){const n=o.querySelector("strong")?.innerText.trim(),l=s.getAttribute("data-message-id")||n;if(n&&l!==t)return t=l,void r((e.botWelcomeMsg||"Chào mừng [name]!").replace("[name]",n))}}const l=s.querySelector(".main-content p");if(!l||s.closest(".me, .owner"))return;const i=l.innerText.trim();if(!i||i.startsWith("[AI]")||i===t)return;const c=s.querySelector(".name span:first-child"),a=c?c.innerText.trim():"User";t=i,async function(t,n){if(!e.botApiKey||o)return null;o=!0;const r=`STRICT CONSTRAINT: \n    1. Detect user language and reply in THAT SAME LANGUAGE. \n    2. Address the user directly as "${t}". DO NOT use "Anh", "Chị", or "Sir/Madam".\n    3. Your Role: ${e.botContext}`;try{const o=e.botModel.startsWith("gemini"),s=o?`https://generativelanguage.googleapis.com/v1beta/models/${e.botModel}:generateContent?key=${e.botApiKey}`:"https://api.mistral.ai/v1/chat/completions",l=o?{contents:[{role:"user",parts:[{text:r}]},{role:"model",parts:[{text:"Understood. I will follow your language constraints and role."}]},{role:"user",parts:[{text:`User "${t}" says: ${n}`}]}],generationConfig:{temperature:.7}}:{model:e.botModel,messages:[{role:"system",content:r},{role:"user",content:n}]},i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...o?{}:{Authorization:`Bearer ${e.botApiKey}`}},body:JSON.stringify(l)}),c=await i.json();return o?c?.candidates?.[0]?.content?.parts?.[0]?.text:c?.choices?.[0]?.message?.content}catch(e){return null}finally{setTimeout((()=>{o=!1}),1e3)}}(a,i).then((e=>{e&&r(e,s)}))}const l=()=>chrome.storage.local.get(null,(t=>Object.assign(e,t)));let i;l(),chrome.storage.onChanged.addListener(l);new MutationObserver((()=>{clearTimeout(i),i=setTimeout(s,600)})).observe(document.body,{childList:!0,subtree:!0})}();