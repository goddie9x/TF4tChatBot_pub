!function(){"use strict";let e={botEnabled:!1,botApiKey:"",botContext:"",botUseInvi:!1,botModel:"gemini-2.0-flash",botWelcomeEnabled:!1,botWelcomeMsg:""},t="",n=!1;const o=(()=>{const e=["ó ¢","ó £","ó ¤","ó ¥","ó ¦","ó §","ó ¨","ó ©","ó ª","ó «","ó ¬","ó ­","ó ®","ó ¯","ó °","ó ±","ó ²","ó ³","ó ´","ó µ","ó ¶","ó ·","ó ¸","ó ¹","ó º","ó ¿"],t=e.length,n=e.reduce(((e,t,n)=>(e[t]=n,e)),{}),o=new RegExp("â€Œ([\\s\\S]+?)ó ¡");return{encode:n=>{if(!n)return"";let o="";for(let r of n){let n=r.codePointAt(0),s=[];for(;n>0;)s.push(n%t),n=Math.floor(n/t);for(;s.length<5;)s.push(0);o+=s.reverse().map((t=>e[t])).join("")}return"â€Œ"+o+"ó ¡"},decode:e=>{const r=o.exec(e);if(!r)return e;const s=Array.from(r[1]);let l="";for(let e=0;e<s.length;e+=5){let o=s.slice(e,e+5);if(o.length<5)break;let r=o.map((e=>n[e])).reverse().reduce(((e,n,o)=>e+n*Math.pow(t,o)),0);l+=String.fromCodePoint(r)}return l},hasInvi:e=>o.test(e)}})();function r(n,r=null){if(r){const e=r.querySelectorAll(".actions .ant-col");if(e.length>0){const t=e[e.length-1].querySelector("button");t&&t.click()}}setTimeout((()=>{const r=document.querySelector(".input-send-box textarea")||document.querySelector("textarea"),s=document.querySelector("button.send-box")||document.querySelector("button[type='submit']");r&&s&&(r.value=e.botUseInvi?o.encode(n):`[AI]: ${n}`,r.dispatchEvent(new Event("input",{bubbles:!0})),t=n,setTimeout((()=>{s.disabled||s.click()}),350))}),400)}function s(){if(!e.botEnabled)return;const o=document.querySelectorAll(".sc-bMvGRv");if(0===o.length)return;const s=o[o.length-1];if(e.botWelcomeEnabled){const n=s.querySelector(".join");if(n){const o=n.querySelector("strong")?.innerText.trim(),l=s.getAttribute("data-message-id")||o;if(o&&l!==t){t=l;const n=(e.botWelcomeMsg||"ChÃ o má»«ng [name]!").replace("[name]",o);return console.log("ðŸ‘‹ ChÃ o ngÆ°á»i má»›i:",o),void r(n)}}}const l=s.querySelector(".main-content p");if(!l||s.closest(".me, .owner"))return;const i=l.innerText.trim();if(!i||i.startsWith("[AI]")||i===t)return;const a=s.querySelector(".name span:first-child"),c=a?a.innerText.trim():"User";t=i,console.log(`ðŸ“© Chat tá»« ${c}:`,i),async function(t,o){if(!e.botApiKey||n)return null;n=!0;const r=`\n    STRICT CONSTRAINT: You must detect the language of the user's message and reply using THAT SAME LANGUAGE. \n    - If the user speaks English, your entire response must be in English.\n    - If the user speaks Vietnamese, your entire response must be in Vietnamese.\n    - If the user speaks any other language, use that language.\n    Your Role: ${e.botContext}\n  `;try{const n=e.botModel.startsWith("gemini"),s=n?`https://generativelanguage.googleapis.com/v1beta/models/${e.botModel}:generateContent?key=${e.botApiKey}`:"https://api.mistral.ai/v1/chat/completions",l=n?{contents:[{role:"user",parts:[{text:r}]},{role:"model",parts:[{text:"Understood. I will follow your language constraints and role."}]},{role:"user",parts:[{text:`User "${t}" says: ${o}`}]}],generationConfig:{temperature:.7}}:{model:e.botModel,messages:[{role:"system",content:r},{role:"user",content:o}]},i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...n?{}:{Authorization:`Bearer ${e.botApiKey}`}},body:JSON.stringify(l)}),a=await i.json();return(n?a?.candidates?.[0]?.content?.parts?.[0]?.text:a?.choices?.[0]?.message?.content)||null}catch(e){return console.error("âŒ Lá»—i gá»i AI:",e),null}finally{setTimeout((()=>{n=!1}),1e3)}}(c,i).then((e=>{e&&r(e,s)}))}const l=()=>chrome.storage.local.get(null,(t=>Object.assign(e,t)));let i;l(),chrome.storage.onChanged.addListener(l);new MutationObserver((()=>{clearTimeout(i),i=setTimeout(s,600)})).observe(document.body,{childList:!0,subtree:!0})}();