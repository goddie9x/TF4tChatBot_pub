let presets=[];function renderPresets(){const e=document.getElementById("presetList");e.innerHTML="",presets.forEach(((t,n)=>{const s=document.createElement("div");s.className="preset-card",s.innerHTML=`\n      <div class="card-header">\n        <div style="flex: 1;">\n          <label>Tên Preset</label>\n          <input type="text" class="p-name" value="${t.name}">\n        </div>\n        <button class="btn btn-delete" data-index="${n}">Xóa</button>\n      </div>\n      <div class="field-group">\n        <label>Vai trò AI (Context)</label>\n        <textarea class="p-context">${t.context}</textarea>\n      </div>\n      <div class="field-group">\n        <label>Lời chào người mới</label>\n        <textarea class="p-welcome">${t.welcome}</textarea>\n      </div>\n    `,e.appendChild(s)}))}chrome.storage.local.get(["presets"],(e=>{presets=e.presets||[{name:"Mặc định",context:"Bạn là trợ lý ảo.",welcome:"Chào mừng [name]!"}],renderPresets()})),document.getElementById("addPreset").addEventListener("click",(()=>{presets.push({name:"Preset mới",context:"",welcome:"Chào [name]!"}),renderPresets()})),document.getElementById("presetList").addEventListener("click",(e=>{e.target.classList.contains("btn-delete")&&(presets.splice(e.target.dataset.index,1),renderPresets())})),document.getElementById("saveAll").addEventListener("click",(()=>{const e=document.querySelectorAll(".preset-card"),t=Array.from(e).map((e=>({name:e.querySelector(".p-name").value,context:e.querySelector(".p-context").value,welcome:e.querySelector(".p-welcome").value})));chrome.storage.local.get(["activePresetIndex"],(e=>{const n=e.activePresetIndex||0,s=t[n]||t[0];chrome.storage.local.set({presets:t,botContext:s?s.context:"",botWelcomeMsg:s?s.welcome:""},(()=>{alert("Đã lưu và đồng bộ!")}))}))}));